<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>[单人]</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">


		<script src="./libs/miniobj.min.js"></script>
		<script src="./libs/zepto.min.js"></script>
		<script src="./src/MCollection.js"></script>
		<script>
		Zepto(function($){
		  console.log('Ready to Zepto!')
			
			//     Zepto.js
			//     (c) 2010-2014 Thomas Fuchs
			//     Zepto.js may be freely distributed under the MIT license.
			//
			//     Some code (c) 2005, 2013 jQuery Foundation, Inc. and other contributors

			;(function($){
			  var slice = Array.prototype.slice

			  function Deferred(func) {
			    var tuples = [
			          // action, add listener, listener list, final state
			          [ "resolve", "done", $.Callbacks({once:1, memory:1}), "resolved" ],
			          [ "reject", "fail", $.Callbacks({once:1, memory:1}), "rejected" ],
			          [ "notify", "progress", $.Callbacks({memory:1}) ]
			        ],
			        state = "pending",
			        promise = {
			          state: function() {
			            return state
			          },
			          always: function() {
			            deferred.done(arguments).fail(arguments)
			            return this
			          },
			          then: function(/* fnDone [, fnFailed [, fnProgress]] */) {
			            var fns = arguments
			            return Deferred(function(defer){
			              $.each(tuples, function(i, tuple){
			                var fn = $.isFunction(fns[i]) && fns[i]
			                deferred[tuple[1]](function(){
			                  var returned = fn && fn.apply(this, arguments)
			                  if (returned && $.isFunction(returned.promise)) {
			                    returned.promise()
			                      .done(defer.resolve)
			                      .fail(defer.reject)
			                      .progress(defer.notify)
			                  } else {
			                    var context = this === promise ? defer.promise() : this,
			                        values = fn ? [returned] : arguments
			                    defer[tuple[0] + "With"](context, values)
			                  }
			                })
			              })
			              fns = null
			            }).promise()
			          },

			          promise: function(obj) {
			            return obj != null ? $.extend( obj, promise ) : promise
			          }
			        },
			        deferred = {}

			    $.each(tuples, function(i, tuple){
			      var list = tuple[2],
			          stateString = tuple[3]

			      promise[tuple[1]] = list.add

			      if (stateString) {
			        list.add(function(){
			          state = stateString
			        }, tuples[i^1][2].disable, tuples[2][2].lock)
			      }

			      deferred[tuple[0]] = function(){
			        deferred[tuple[0] + "With"](this === deferred ? promise : this, arguments)
			        return this
			      }
			      deferred[tuple[0] + "With"] = list.fireWith
			    })

			    promise.promise(deferred)
			    if (func) func.call(deferred, deferred)
			    return deferred
			  }

			  $.when = function(sub) {
			    var resolveValues = slice.call(arguments),
			        len = resolveValues.length,
			        i = 0,
			        remain = len !== 1 || (sub && $.isFunction(sub.promise)) ? len : 0,
			        deferred = remain === 1 ? sub : Deferred(),
			        progressValues, progressContexts, resolveContexts,
			        updateFn = function(i, ctx, val){
			          return function(value){
			            ctx[i] = this
			            val[i] = arguments.length > 1 ? slice.call(arguments) : value
			            if (val === progressValues) {
			              deferred.notifyWith(ctx, val)
			            } else if (!(--remain)) {
			              deferred.resolveWith(ctx, val)
			            }
			          }
			        }

			    if (len > 1) {
			      progressValues = new Array(len)
			      progressContexts = new Array(len)
			      resolveContexts = new Array(len)
			      for ( ; i < len; ++i ) {
			        if (resolveValues[i] && $.isFunction(resolveValues[i].promise)) {
			          resolveValues[i].promise()
			            .done(updateFn(i, resolveContexts, resolveValues))
			            .fail(deferred.reject)
			            .progress(updateFn(i, progressContexts, progressValues))
			        } else {
			          --remain
			        }
			      }
			    }
			    if (!remain) deferred.resolveWith(resolveContexts, resolveValues)
			    return deferred.promise()
			  }

			  $.Deferred = Deferred
			})(Zepto)
			
			var deferred = $.Deferred && $.Deferred();
		
			var rendering = new $.Deferred();;
			rendering.done(function(){
			    console.log('Finished rendering');
			});

			//...

			rendering.resolve();
				
			// var createDeferred = function() {
	//       return new $.Deferred()
	//     }
	// 	  createDeferred(function(defer){
	// 	  	defer.resolve("done")
	// 	  }).done(function() {
	//
	// 	    alert("resolved", this.state(), "Deferred is resolved (state)")
	// 	  }).fail(function() {
	// 	    alert("Error on resolve")
	// 	  }).always(function() {
	// 	    alert('always')
	// 	  })
			
			
		});
	
 
									//
			// //清楚所有缓存
			// LocalStore.clear();
			//
			// var collection = new Collection('message_test');
			//
			// collection.use_websql();
			//
			// var obj = {
			// 	type :'type',
			// 	mid :'mid',
			// 	uid :'uid',
			// 	uname :'uname',
			// 	avatar :'avatar',
			// 	sid :'sid',
			// 	sname:'sname',
			// 	timestamp :'timestamp',
			// 	msg :'msg'
			// }
			// // ok
			// collection.add(obj);
			// // ok
			// collection.save();
			//
			//
			// var arr = collection.all();
			//
			// console.log(arr);
			//
			// var m = collection.get(0);
			// console.log(m.type);
			//
			
			// collection.drop();
			
		 	// var saved_obj = collection.save(obj);
			//
			// 	var myobj = collection.get(saved_obj.id);
			//
			// 	var arr = collection.all();
			
			
			
		</script>
  </head>
  <body>
		
  </body>
</html>
